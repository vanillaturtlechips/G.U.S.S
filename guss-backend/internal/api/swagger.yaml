openapi: 3.0.0
info:
  title: G.U.S.S (Gym User Support Service) API
  description: 실시간 헬스장 혼잡도 확인, 상세 정보 조회 및 대기열 기반 예약 시스템 API
  version: 1.1.0

servers:
  - url: http://localhost:9000/api
    description: 로컬 개발 서버

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        user_name: { type: string, example: "테스트유저03" }
        user_phone: { type: string, example: "010-1234-5678" }
        user_id: { type: string, example: "testuser03" }
        user_pw: { type: string, format: password }

    Gym:
      type: object
      properties:
        guss_number: { type: integer, example: 1 }
        guss_name: { type: string, example: "명지대 인문캠퍼스 MCC 체육시설" }
        guss_address: { type: string, example: "서울특별시 서대문구 거북골로 34" }
        guss_phone: { type: string, example: "02-300-1521" }
        guss_status: { type: string, enum: [open, close], example: "open" }
        guss_user_count: { type: integer, example: 1 }
        guss_size: { type: integer, example: 50 }
        guss_open_time: { type: string, example: "06:00" }
        guss_close_time: { type: string, example: "23:00" }
        guss_ma_type: { type: string, example: "러닝머신, 피클볼" }
        guss_ma_count: { type: integer, example: 25 }
        guss_ma_state: { type: string, example: "신규 개관(최상)" }

    LoginResponse:
      type: object
      properties:
        token: { type: string, example: "eyJhbGciOiJIUzI1..." }
        user_name: { type: string, example: "테스트유저03" }
        role: { type: string, enum: [USER, ADMIN], example: "USER" }

    ReserveResponse:
      type: object
      properties:
        message: { type: string, example: "Reservation process completed" }
        status: 
          type: string
          enum: [CONFIRMED, WAITING, DUPLICATE]
          description: "CONFIRMED: 예약 확정, WAITING: 정원 초과로 대기, DUPLICATE: 이미 예약 존재"
          example: "CONFIRMED"

paths:
  /register:
    post:
      summary: 회원가입
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: 가입 성공
        '500':
          description: 서버 오류 (아이디 중복 등)

  /login:
    post:
      summary: 로그인
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id: { type: string }
                user_pw: { type: string }
      responses:
        '200':
          description: 로그인 성공 및 사용자 정보 반환
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: 인증 실패 (비밀번호 불일치 등)

  /gyms:
    get:
      summary: 헬스장 목록 조회 (지도 마커 및 요약 정보)
      tags: [Gym]
      responses:
        '200':
          description: 전체 체육관 리스트 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Gym'

  /gyms/{id}:
    get:
      summary: 상세 정보 및 실시간 혼잡도 조회
      tags: [Gym]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: 체육관 상세 정보 및 계산된 혼잡도 수치 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  gym: { $ref: '#/components/schemas/Gym' }
                  congestion: { type: number, example: 0.02, description: "계산된 혼잡도 비율 (0~1)" }

  /reserve:
    post:
      summary: 이용 예약 (JWT 인증 필수)
      tags: [Reservation]
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                fk_guss_number: { type: integer, example: 1 }
      responses:
        '200':
          description: 예약 처리 완료 (상태에 따라 확정/대기/중복 판정)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReserveResponse'
        '401':
          description: 인증 실패 (토큰 누락 또는 만료)

  /admin/logs:
    get:
      summary: 관리자 로그 조회 (매출/예약 현황)
      description: ADMIN 권한이 있는 사용자만 접근 가능합니다.
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 관리자용 로그 데이터 반환
        '403':
          description: 권한 부족 (ADMIN이 아님)